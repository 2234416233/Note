# 图像bayer格式介绍以及bayer插值原理CFA



# 1 图像bayer格式介绍

　　bayer格式图片是伊士曼·柯达公司科学家Bryce Bayer发明的，Bryce Bayer所发明的拜耳阵列被广泛运用数字图像。

　　对于彩色图像，需要采集多种最基本的颜色，如rgb三种颜色，最简单的方法就是用滤镜的方法，红色的滤镜透过红色的波长，绿色的滤镜透过绿色的波长，蓝色的滤镜透过蓝色的波长。如果要采集rgb三个基本色，则需要三块滤镜，这样价格昂贵，且不好制造，因为三块滤镜都必须保证每一个像素点都对齐。当用bayer格式的时候，很好的解决了这个问题。bayer 格式图片在一块滤镜上设置的不同的颜色，通过分析人眼对颜色的感知发现，人眼对绿色比较敏感，所以一般bayer格式的图片绿色格式的像素是是r和g像素的和。

　　另外，Bayer格式是相机内部的原始图片, 一般后缀名为.raw。很多软件都可以查看, 比如PS。我们相机拍照下来存储在存储卡上的.jpeg或其它格式的图片, 都是从.raw格式转化过来的。如下图，为bayer色彩滤波阵列，由一半的G，1/4的R，1/4的B组成。

　　　　　　　　　　　　　　　　　　　　　　![img](https://images2015.cnblogs.com/blog/893951/201603/893951-20160311230241647-1789390294.png)

## 2 bayer格式图像传感器硬件

　　图像传感器的结构如下所示，每一个感光像素之间都有金属隔离层，光纤通过显微镜头，在色彩滤波器过滤之后，投射到相应的漏洞式硅的感光元件上。 

　　　　　　　　　　![img](https://images2015.cnblogs.com/blog/893951/201603/893951-20160311230327210-1156084365.png) 

　　当Image Sensor往外逐行输出数据时，像素的序列为GRGRGR.../BGBGBG...（顺序RGB）。这样阵列的Sensor设计，使得RGB传感器减少到了全色传感器的1/3，如下所示。

　　　　　　　　　　　　　　　　　　　　　　　　![img](https://images2015.cnblogs.com/blog/893951/201603/893951-20160311230428413-1301823553.png)

## 3 bayer格式插值红蓝算法实现

　　每一个像素仅仅包括了光谱的一部分，必须通过插值来实现每个像素的RGB值。为了从Bayer格式得到每个像素的RGB格式，我们需要通过插值填补缺失的2个色彩。插值的方法有很多（包括领域、线性、3*3等），速度与质量权衡，最好的线性插值补偿算法。其中算法如下： 

　　R和B通过线性领域插值，但这有四种不同的分布，如下图所示： 

 　　　　　　　　　　　　　　　　　![img](https://images2015.cnblogs.com/blog/893951/201603/893951-20160311230501554-1232262581.png)

​            　　　　　　　　　　　　　　　(a)                  (b)

 　　　　　　　　　　　　　　　　　![img](https://images2015.cnblogs.com/blog/893951/201603/893951-20160311230544663-1346580093.png)

　　　　　　　　　　　　　　　　　　　　　　　　 (c)                  (d)

　　在（a）与（b）中，R和B分别取邻域的平均值。

　　在（c）与（d）中，取领域的4个B或R的均值作为中间像素的B值。 

## 4 bayer格式插值绿算法实现

 　　　　　　　　　　　![img](https://images2015.cnblogs.com/blog/893951/201603/893951-20160311230635991-2089764601.png)

   　　　　　　　　　　　　　　　　　　 (c)                            (d)

　　由于人眼对绿光反应最敏感，对紫光和红光则反应较弱，因此为了达到更好的画质，需要对G特殊照顾。在上述（c）与（d）中，扩展开来就是上图的（e）与（f）中间像素G的取值，者也有一定的算法要求，不同的算法效果上会有差异。经过相关的研究，

　　（e）中间像素G值的算法如下： 

 　　　　　　　　　　　　　　　　　![img](https://images2015.cnblogs.com/blog/893951/201603/893951-20160311230723647-380711004.png)

　　（f）中间像素G值的算法如下：

 　　　　　　　　　　　　　　　　　![img](https://images2015.cnblogs.com/blog/893951/201603/893951-20160311230748194-1081239687.png)　　　　　　

　　CMOS摄像头这部分转换是在内部用ADC或者ISP完成的，生产商为了降低成本必然会使得图像失真。当然用外部处理器来实现转换，如果处理器的速度足够NB，能够胜任像素的操作，用上面的算法来进行转换，皆大欢喜。不过上述算法将直接成倍提高了算法的复杂度，速度上将会有所限制。因此为了速度的提成，可以直接通过来4领域G取均值来中间像素的G值，将会降低一倍的速率，而在性能上差之甚微，算法如下： 

 　　　　　　　　　　　　　　　　　![img](https://images2015.cnblogs.com/blog/893951/201603/893951-20160311230816788-692690023.png)

　　如果能够通过损失图像的额质量，来达到更快的速度，还可以取G1、G2的均值来实现，但是这样的做法会导致边沿以及跳变部分的失真。 